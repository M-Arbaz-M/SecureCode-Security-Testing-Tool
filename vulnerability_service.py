import subprocess
import re

class VulnerabilityService:

    def detect_vulnerabilities(self, code):
        """
        This function scans the provided Python code for vulnerabilities using Bandit.
        It captures the output, filters it to hide CWE details and extra links.
        """

        with open("temp_code.py", "w", encoding="utf-8") as temp_file:
            temp_file.write(code)

        result = subprocess.run(['bandit', '-r', 'temp_code.py'], capture_output=True, text=True, encoding="utf-8")

        filtered_output = re.sub(r'CWE:.*?\n', '', result.stdout) 
        filtered_output = re.sub(r'More Info:.*?\n', '', filtered_output) 
        
        return filtered_output
